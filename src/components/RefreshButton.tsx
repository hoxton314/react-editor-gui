import { FC, useEffect, useState } from 'react'
import { css, styled } from 'styled-components'
import { Animatable } from '@styles/generic.styles'

export const StyledRefreshButton = styled.button<{ $shouldAnimate?: boolean }>`
  border: none;
  outline: none;
  height: 100%;
  aspect-ratio: 1;
  /* background-color: inherit; */
  background-color: ${({ theme }) => theme.colors['activityBar.background']};
  border-left: 1px solid ${({ theme }) => theme.colors['activityBar.border']};
  color: ${({ theme }) => theme.colors['icon.foreground']};
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;

  &:hover {
    /* filter: brightness(1.5); */
    background-color: ${({ theme }) => `${theme.colors['activityBar.inactiveForeground']}35`};
  }

  // spin animation when refreshing
  ${({ $shouldAnimate }) =>
    $shouldAnimate &&
    css`
      animation: spin 1s linear infinite;
    `}

  ${Animatable}
`

interface RefreshButtonProps {
  onClick: () => void | Promise<void>
  isLoading?: boolean
}

export const RefreshButton: FC<RefreshButtonProps> = ({ onClick, isLoading }) => {
  const [shouldRefreshSpin, setShouldRefreshSpin] = useState(false)

  useEffect(() => {
    setShouldRefreshSpin(isLoading)
  }, [isLoading])

  return (
    <StyledRefreshButton
      $shouldAnimate={shouldRefreshSpin}
      onClick={async () => {
        onClick()
      }}
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <g clipPath="url(#clip0_108_186)">
          <path
            d="M10.1085 8.28635C10.3213 8.28635 10.5305 8.20377 10.6877 8.048L14.0232 4.74208C14.0255 4.73988 14.0274 4.73736 14.0296 4.73511C14.0342 4.7304 14.0385 4.7253 14.043 4.72047C14.0567 4.70589 14.0703 4.69125 14.0828 4.67579C14.087 4.67063 14.0907 4.66504 14.0948 4.65978C14.107 4.64393 14.1191 4.62803 14.1301 4.61142C14.1338 4.60588 14.1369 4.59996 14.1404 4.59431C14.1512 4.5772 14.1617 4.56004 14.1712 4.54222C14.1739 4.53696 14.1763 4.53136 14.1789 4.52605C14.1884 4.50702 14.1976 4.48794 14.2056 4.46831C14.2073 4.46409 14.2087 4.4597 14.2103 4.45548C14.2186 4.43399 14.2264 4.41227 14.2329 4.39012C14.2339 4.38683 14.2346 4.38343 14.2355 4.3802C14.242 4.35673 14.2478 4.33299 14.2523 4.30892C14.2525 4.30804 14.2527 4.30722 14.2529 4.3064C14.2535 4.30322 14.2536 4.30004 14.2542 4.29686C14.2581 4.27399 14.2613 4.25096 14.2633 4.22766C14.2639 4.22092 14.264 4.21423 14.2644 4.20754C14.2653 4.19224 14.2668 4.17705 14.2669 4.16165C14.2669 4.15677 14.2663 4.15194 14.2662 4.14701C14.2661 4.13812 14.2655 4.12935 14.265 4.12047C14.2642 4.10248 14.2632 4.0845 14.2612 4.06668C14.2601 4.05692 14.2584 4.04738 14.257 4.03767C14.2545 4.02079 14.2519 4.00401 14.2484 3.98734C14.2463 3.97775 14.2437 3.96837 14.2413 3.95888C14.2372 3.94233 14.233 3.92582 14.2278 3.90959C14.2251 3.90093 14.2218 3.89248 14.2188 3.88393C14.2129 3.86715 14.2068 3.85054 14.1998 3.8342C14.1966 3.8268 14.193 3.81962 14.1896 3.81232C14.1818 3.79538 14.1737 3.7786 14.1647 3.76221C14.1612 3.75579 14.1573 3.74971 14.1536 3.7434C14.1439 3.72679 14.1341 3.71034 14.1232 3.69444C14.1191 3.68841 14.1145 3.68276 14.1102 3.67684C14.099 3.66138 14.0878 3.64602 14.0755 3.63133C14.0702 3.62486 14.0643 3.61888 14.0587 3.61258C14.0487 3.60128 14.0391 3.58966 14.0285 3.57891L10.7225 0.243489C10.4883 0.00722577 10.1349 -0.0647113 9.82702 0.0611786C9.51909 0.187123 9.31743 0.486112 9.31589 0.818766L9.30334 3.63007C7.46604 4.22273 5.83457 5.41435 4.70978 7.0814C3.43213 8.97518 2.9442 11.2573 3.33596 13.5073C3.72657 15.7508 4.94928 17.7287 6.77896 19.0768C6.92585 19.185 7.0967 19.2372 7.26613 19.2372C7.51856 19.2372 7.76771 19.1213 7.92891 18.9025C8.19835 18.5368 8.12032 18.0219 7.75461 17.7525C4.66077 15.473 3.92226 11.1898 6.07341 8.0014C6.88182 6.80314 8.01225 5.90705 9.29555 5.38222L9.28629 7.46017C9.28481 7.79282 9.48384 8.09362 9.79061 8.22225C9.89331 8.2654 10.0013 8.28635 10.1085 8.28635Z"
            fill="currentColor"
          />
          <path
            d="M20.6644 10.493C20.274 8.24967 19.0515 6.27178 17.222 4.92362C16.8563 4.65413 16.3415 4.7321 16.072 5.09776C15.8025 5.46342 15.8805 5.97833 16.2462 6.24777C19.3396 8.52738 20.0778 12.8104 17.9268 15.9985C17.1185 17.1966 15.9884 18.0929 14.7053 18.6178L14.7147 16.5399C14.7161 16.2073 14.5171 15.9065 14.2103 15.7778C13.9036 15.649 13.5496 15.7179 13.3133 15.952L9.9775 19.2577C9.97564 19.2596 9.97405 19.2616 9.97224 19.2635C9.96423 19.2715 9.95694 19.2802 9.94926 19.2886C9.93901 19.2999 9.92848 19.311 9.91889 19.3227C9.91121 19.3321 9.9043 19.3422 9.89707 19.352C9.88846 19.3636 9.87952 19.3749 9.87157 19.3869C9.86477 19.3972 9.85874 19.4081 9.85232 19.4187C9.84487 19.4311 9.83714 19.4433 9.83039 19.456C9.82518 19.4659 9.82074 19.4762 9.81592 19.4863C9.80895 19.5007 9.80188 19.515 9.79579 19.5298C9.79239 19.5381 9.78965 19.5469 9.78653 19.5554C9.78006 19.5727 9.7737 19.5901 9.76838 19.6078C9.7663 19.6148 9.76482 19.6221 9.7629 19.6292C9.75758 19.6489 9.75264 19.6687 9.7488 19.6888C9.74848 19.6904 9.74793 19.692 9.74765 19.6936C9.7465 19.6998 9.74623 19.7058 9.74524 19.7119C9.74217 19.7311 9.73932 19.7503 9.73762 19.7697C9.73669 19.7802 9.73647 19.7906 9.73592 19.801C9.73532 19.8134 9.73395 19.8257 9.73389 19.8382C9.73384 19.8422 9.73438 19.8461 9.73444 19.8501C9.73455 19.8629 9.73548 19.8756 9.73614 19.8883C9.73696 19.9023 9.73756 19.9162 9.7391 19.9301C9.74058 19.944 9.74288 19.9576 9.74502 19.9712C9.74705 19.984 9.74891 19.9967 9.75155 20.0093C9.7544 20.0231 9.75807 20.0366 9.76164 20.0502C9.76487 20.0625 9.76794 20.0749 9.77172 20.087C9.77578 20.1 9.78055 20.1126 9.78527 20.1253C9.78987 20.1378 9.79426 20.1503 9.79947 20.1625C9.80446 20.1742 9.81011 20.1856 9.81564 20.1971C9.82167 20.2097 9.8276 20.2224 9.83423 20.2346C9.8401 20.2454 9.84668 20.2559 9.85304 20.2664C9.86038 20.2786 9.86762 20.2908 9.87563 20.3027C9.88275 20.3132 9.8906 20.3232 9.89822 20.3334C9.90639 20.3444 9.91434 20.3555 9.92311 20.3661C9.93238 20.3773 9.94235 20.3878 9.95217 20.3985C9.95897 20.4059 9.96516 20.4137 9.97224 20.4208L13.2783 23.7565C13.4359 23.9154 13.6473 24 13.8627 24C13.9674 24 14.073 23.98 14.1738 23.9387C14.4817 23.8128 14.6834 23.5138 14.6849 23.1812L14.6975 20.3702C16.5346 19.7774 18.1658 18.5853 19.2904 16.9184C20.568 15.0249 21.056 12.7429 20.6644 10.493Z"
            fill="currentColor"
          />
        </g>
        <defs>
          <clipPath id="clip0_108_186">
            <rect width="24" height="24" fill="white" />
          </clipPath>
        </defs>
      </svg>
    </StyledRefreshButton>
  )
}
